<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <title>靓号购买</title>
    <script type="text/javascript" src="__STATIC__/js/jquery.min.js"></script>    
    <script type="text/javascript" src="__STATIC__/js/bootstrap.min.js"></script>
    <link rel="stylesheet" href="__STATIC__/css/bootstrap.min.css" />   
    <link rel="stylesheet" href="__STATIC__/css/common.css" /> 
    <link rel="stylesheet" href="__STATIC__/css/Integral.css" />
    <script src="__STATIC__/layer/mobile/layer.js" rel="stylesheet"></script>
    <script type="text/javascript">
   		document.addEventListener('plusready', function(){
   			//console.log("所有plus api都应该在此事件发生后调用，否则会出现plus is undefined。"
   		});
    </script>
</head>
<body>
	<div id="box">
		<div class="Integral">
			<!--靓号 -->
			<div class="number_choose">
				<header>靓号选择</header>
				{volist name="luck" id="v"}
				<div class="container">
					<p class="head"> {$v.type} 位 靓 号</p>
					<article class="row">
						{volist name="v.list" id="vl"}
							<aside class="col-xs-4 col-sm-4 col-md-4 col-lg-4">
								<dl>
									<a href="#" class="btn btn-lg luck_sel" data-toggle="modal" data-target="#myModal" data-id="{$vl.id}" data-nubmer="{$vl.nubmer}">
										<dt>
											<span>{$vl.nubmer}</span>
											<span><em>{$vl.coin}</em>{$coin_name}</span>
										</dt>
									</a>
								</dl>
							</aside>
						{/volist}
					</article>
				</div>
				{/volist}
				<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
									&times;
								</button>
								<h4 class="modal-title" id="myModalLabel">
									确认购买靓号
								</h4>
							</div>
							<div class="modal-body">
								<div class="exchange_prompt">
									<p><img src="__STATIC__/img/tishi1.png" /></p>
									<p><big class="one"></big></p>
									{if condition="$user_nubmer"}
										<p>已有靓号{$user_nubmer}<br/>是否放弃靓号{$user_nubmer}购买新靓号？</p>
									{else/}
										<p><big>是否确认购买此靓号？</big></p>
									{/if}
									
								</div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-default" data-dismiss="modal">取消购买
								</button>
								<button type="button" class="btn btn-primary luck_btn">
									确认购买
								</button>
							</div>
						</div><!-- /.modal-content -->
					</div><!-- /.modal -->
				</div>
			</div>
		</div>
	</div>
</body>
<script type="text/javascript">
	var uid= "{$uid}";
	var token= "{$token}";
	$(".luck_sel").click(function () {
		var nubmer = $(this).attr("data-nubmer");
		var id = $(this).attr("data-id");
		$(".one").html(nubmer);
		$(".luck_btn").attr("data-id",id);
	});
	$(".luck_btn").click(function(){
		var id = $(this).attr("data-id");
		$.ajax({
		    type: 'POST',
		    url: "{:url('luck_api/buy_luck')}",
		    data: {'uid': uid,'token':token,'id':id},
		    dataType: 'json',
		    success: function (data) {
		    	$('#myModal').modal('hide');
		 		if(data.code == 1){
		 			layer.open({
			            content: data.msg
			            ,skin: 'msg'
			            ,time: 2 //2秒后自动关闭
			            ,end:function () {
                       		var url="{:url('luck_api/index')}?uid="+uid+"&token="+token;
							window.location.href=url;
                        }
			          });
		 		}else{
		 			layer.open({
		            content: data.msg
		            ,skin: 'msg'
		            ,time: 2 //2秒后自动关闭
		          });
		 		}
		    }
		  });
		
	})
</script>
</html>