<include file="public@header" />
<body>
<div class="wrap js-check-wrap">
    <ul class="nav nav-tabs">
        <li class="active"><a href="{:url('agent/voice')}">房间列表</a></li>
    </ul>
    <form class="well form-inline margin-top-20" method="post" action="{:url('agent/voice')}">
        房间ID:
        <input type="text" class="form-control" name="voice_id" style="width: 120px;"
               value="{:input('request.voice_id/s','')}" placeholder="房间ID">
        状态：
        <select class="form-control" name="status" >
            <option value="0">全部</option>
            <option value="1"
            <if condition="$data['status'] eq 1"> selected="selected"</if>
            >正常</option>
            <option value="2"
            <if condition="$data['status'] eq 2"> selected="selected"</if>
            >关闭</option>
            <option value="3"
            <if condition="$data['status'] eq 3"> selected="selected"</if>
            >删除</option>
        </select>
        <input type="submit" class="btn btn-primary" value="搜索" />
        <a class="btn btn-danger" href="{:url('agent/voice')}">清空</a>
        <input type="button" class="btn btn-info" style="background-color: #1dccaa;" value="添加" id="addvalue">
    </form>
    <table class="table table-hover table-bordered">
        <thead>
        <tr>
            <th>房间号</th>
            <th>状态</th>
            <th>备注</th>
            <th>创建时间</th>
            <th>更新时间</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        <php>
            $status = array('1'=>'正常','2'=> '关闭','3'=>'删除');
        </php>
        <foreach name="users" item="vo">
            <tr>
                <td>{$vo.voice_id}</td>
                <td>{$status[$vo.status]}</td>
                <td>{$vo.remarks}</td>
                <td>{:date('Y-m-d H:i',$vo['create_time'])}</td>
                <td>{:date('Y-m-d H:i',$vo['update_time'])}</td>
                <td>
                    <if condition="$vo['status'] != 1">
                        <a href="javascript:void(0)" onclick="SaveVoice({$vo.voice_id},1)">开启</a>
                    </if>
                    <if condition="$vo['status'] != 2">
                        <a href="javascript:void(0)" onclick="SaveVoice({$vo.voice_id},2)">关闭</a>
                    </if>
                    <if condition="$vo['status'] != 3">
                        <a href="javascript:void(0)" onclick="SaveVoice({$vo.voice_id},3)">删除</a>
                    </if>
                </td>
            </tr>
        </foreach>
        </tbody>
    </table>
    <div class="pagination">{$page}</div>
</div>
<script src="__STATIC__/js/admin.js"></script>
<script src="/agent/public/static/js/layer/layer.js" rel="stylesheet"></script>
<script>
    function SaveVoice(voice_id,status) {
        let title="删除房间号："+voice_id;
        let content= "删除后，清空所有绑定渠道的房间号";
        if (status == 1) {
            title ="开启房间号：" +voice_id;
            content= "开启后，自动跳转到房间号:"+voice_id;
        } else if(status == 2) {
            title ="关闭房间号：" +voice_id;
            content= "关闭后，停止跳转到房间号:"+voice_id;
        }
        layer.open({
            title: title
            ,content: content,
            yes: function(index, layero){
                $.ajax({
                    url: "{:url('agent/save_voice')}",
                    type: 'post',
                    dataType: 'json',
                    data: {'voice_id': voice_id,'status':status},
                    success: function (data) {
                        if (data.code == 1) {
                            layer.msg(data.msg, {time: 2000, icon: 1}, function () {
                                window.location.reload();
                            });
                        } else {
                            layer.msg(data.msg, {time: 2000, icon: 2});
                            layer.close(index);
                        }
                    }
                });
                layer.close(index);
            }
        });
    }
    $("#addvalue").click(function () {
        layer.open({
            title: '添加房间',
            formType: 2,
            area: ['350px', '310px'],
            btnAlign: 'c',
            content: `<div><p>房间号:</p><input type="text" id="voice_id" style="width:100%;height:35px;padding:0 15px;"/> </div><div><p>备注:</p><textarea name="txt_remark" id="remark" style="width:100%;height:60px;padding:0 15px;"></textarea></div>`,
            btn:['确认','取消'],
            yes: function (index, layero) {
                const value1 = $('#remark').val();//获取多行文本框的值
                const voice_id = $('#voice_id').val();//获取多行文本框的值
                $.ajax({
                    url: "{:url('agent/add_voice')}",
                    type: 'post',
                    dataType: 'json',
                    data: {'remarks': value1,'voice_id':voice_id},
                    success: function (data) {
                        if (data.code == 1) {
                            layer.msg(data.msg, {time: 2000, icon: 1}, function () {
                                window.location.reload();
                            });
                        } else {
                            layer.msg(data.msg, {time: 2000, icon: 2});
                            layer.close(index);
                        }
                    }
                });
                layer.close(index);
            },
            no:function(index){
                layer.close(index);
                return false;//点击按钮按钮不想让弹层关闭就返回false
            }
        });
    });

</script>
</body>