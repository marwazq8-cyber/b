<include file="public@header" />
<style>
    .form-control_sum{width: 100px;height:35px;line-height:35px;float: left; margin-right: 10px;margin-bottom: 10px;}
    .form-control_sum_btn{background: #2c3e50;color:#fff;    line-height: 24px!important;  width: 54px!important;}
    /*.config_left{width: 150px;float:left;border:1px solid #ccc;min-height: 850px;background: #4e4e4e;}*/
    #div_content{float:left;width: calc(100% - 160px);margin-left:10px;padding:10px;}
    /*.config_left li{width: 100%;}*/
    .config_left li a{color:#7b8a8b;background-color: #d8e0e6;border-top-left-radius: 5px;border-top-right-radius: 5px;}
    .config_left li a:hover{color:#7b8a8b;}
    .config_left .active a{background: #ffffff!important;}
    .config_left_type{width: 100%;background: #2c3e50;color:#fff;height: 40px;line-height: 40px;text-align: center;}
    .wrap .config_red{float:left;width: 100%;height: 50px;line-height: 50px; background: #2c3e50;padding-left: 40px;margin-bottom: 10px;color: #fff;}
    .config_left_box{
        width: 100%;
        /*height: 50px;
    overflow-y: hidden;
    overflow-x: scroll;*/
    }
    .config_left{
        /*position: fixed;
    top: 0;*/
        z-index: +999;
        min-width: 100%;
        height: 100%;
        /*border:1px solid #ccc;*/
        background: #e8edf0;
        white-space:normal;
        overflow: hidden;
    }
    .config_left li{
        list-style: none;
        float: left;
        overflow: hidden;
        padding: 2px 5px;
        margin-top: 5px;
    }
    .config_left li a{
        text-decoration: none;
        /*padding: 15px 5px;*/
        margin: 0;
    }
    .config_left li a:hover{
        /*color: #7b8a8b;*/
        background-color: #ffffff;
        color: #2C3E50;
    }
    .config_left .active a:hover{
        color: #7b8a8b;
    }
    .config_left .active a {
        color: #7b8a8b;
        margin: 0;
    }
    .tab-pane:nth-child(even) .form-group{
        background-color: #ffffff;
    }
    .tab-pane{
        width: 100%;
        display: none;
        overflow: auto;
    }
    .active{
        /*display: revert;*/
        display: block;
    }
    .desc-text{
        font-size: 12px;
        color: #0cb007;
    }
    .table-th{
        width: 100%;
        overflow: hidden;
        font-size: 15px;
        font-weight: 600;
        padding: 10px 0;
        border-top: 1px solid #EDF0F1;
        background-color: #f9f9f9;
    }
    .table-th-l{
        width: 40%;
        float: left;
    }
    .table-th-r{
        width: 60%;
        float: left;
    }
    .li-table{
        width: 100%;
        overflow: hidden;
        list-style: none;
        border-top: 1px solid #EDF0F1;
        padding: 10px 0;

    }
    .li-table-l{
        width: 40%;
        float: left;
        overflow: hidden;
    }
    .li-table-r{
        width: 60%;
        float: left;
        overflow: hidden;
    }
    .li-table:nth-of-type(even){
        background-color: #f9f9f9;
    }
    .li-bottom{
        margin-top: 10px;
    }
    .btn-bj{
        text-decoration: none;
        cursor: pointer;
    }
</style>
<!-- 颜色值 -->
<link href="__TMPL__/public/assets/simpleboot3/css/colpick.css" rel="stylesheet">

</head>
<body>
<div class="wrap js-check-wrap" style="padding:0px;">
    <!--nav nav-tabs-->
    <div class="config_left_box">
        <ul class="nav nav-tabs config_left">
            <foreach name="type" item="vo">
                <li <if condition="$key eq 0"> class="active" </if>>
                <a href="#{$key}" data-toggle="tab" class="group" data-id="{:lang($vo.group_id)}">{:lang($vo.group_id)}</a>
                </li>
            </foreach>
            <li>
                <a href="{:url('systems/add_sys')}" >{:lang("添加配置")}</a>
            </li>
        </ul>
    </div>
    <input type="hidden" class="group_id_val" name="group_id" value="{$type[0]['group_id']|default=''}">

    <div id="div_content">
    <form class="form-horizontal margin-top-20" role="form" action="{:url('systems/upd_post')}" method="post">

        <!--        <table class="table table-striped">-->

        <div class="table-th">
            <div class="table-th-l">
                {:lang('变量标题')}
            </div>
            <div class="table-th-r">
                {:lang('变量值')}
            </div>
        </div>
        <!--            <ul>-->
        <foreach name="type" item="vo" key='k'>
            <div style="width: 100%" id="{$k}" <if condition="$k eq 0"> class="tab-pane active" <else/>  class="tab-pane" </if> >
            <foreach name="config" item="v">
                <if condition="($v['group_id'] eq $vo['group_id']) and ($v['type'] eq 0)">
                    <li class="li-table">
                        <div class="li-table-l">
                            {:lang($v['title'])}
                            <div class="desc-text">
                                <if condition="$v['desc']">
                                    {:lang($v['desc'])}
                                </if>
                            </div>
                            <if condition="$debug eq 1 && $admin_id eq 1">
                                <a class="btn-bj" data-id="{$v['code']}" data-val="{$v['desc']}" data-title="{$v['title']}" data-sort="{$v['sort']}">{:lang('EDIT')}</a>
                            </if>
                        </div>
                        <div class="li-table-r">
                            <if condition="$v['code'] eq 'acquire_group_id'">
                                <input type="text" class="form-control" disabled="disabled" name="{$v['code']}" value="{$v['val']|default=''}">
                                <else/>
                                <input type="text" class="form-control" id="input-site-name" name="{$v['code']}" value="{$v['val']|default=''}">
                            </if>
                        </div>
                    </li>

                </if>

                <if condition="($v['group_id'] eq $vo['group_id']) and ($v['type'] eq 1)">
                    <li class="li-table">
                        <div class="li-table-l">
                            {:lang($v['title'])}
                            <div class="desc-text">
                                <if condition="$v['desc']">
                                    {:lang($v['desc'])}
                                </if>
                            </div>
                            <if condition="$debug eq 1 && $admin_id eq 1">
                                <a class="btn-bj" data-id="{$v['code']}" data-val="{$v['desc']}"  data-title="{$v['title']}" data-sort="{$v['sort']}">{:lang('EDIT')}</a>
                            </if>
                        </div>
                        <div class="li-table-r">
                            <textarea rows="3" class="form-control" name="{$v['code']}">{$v['val']}</textarea>
                        </div>
                    </li>

                </if>

                <if condition="($v['group_id'] eq $vo['group_id']) and ($v['type'] eq 2)">
                    <li class="li-table">
                        <div class="li-table-l">
                            {:lang($v['title'])}
                            <div class="desc-text">
                                <if condition="$v['desc']">
                                    {:lang($v['desc'])}
                                </if>
                            </div>
                            <if condition="$debug eq 1 && $admin_id eq 1">
                                <a class="btn-bj" data-id="{$v['code']}" data-val="{$v['desc']}"  data-title="{$v['title']}" data-sort="{$v['sort']}">{:lang('EDIT')}</a>
                            </if>
                        </div>
                        <div class="li-table-r">
                            <div style="text-align: center;">
                                <input type="hidden" name="{$v['code']}" id="{$v['code']}" value="{$v.val|default=''}">
                                <a href="javascript:uploadOneImage('{:lang("图片上传")}','#{$v.code}');">
                                <if condition="empty($v['val'])">
                                    <img src="__TMPL__/public/assets/images/default-thumbnail.png"
                                         id="{$v['code']}-preview" width="135" style="cursor: hand"/>
                                    <else/>
                                    <img src="{:cmf_get_image_preview_url($v['val'])}" id="{$v['code']}-preview"
                                         width="135" style="cursor: hand"/>
                                </if>
                                </a>
                                <input type="button" class="btn btn-sm"
                                       onclick="$('#{$v.code}-preview').attr('src','__TMPL__/public/assets/images/default-thumbnail.png');$('#{$v.code}').val('');return false;"
                                       value="{:lang('取消图片')}">
                            </div>
                        </div>
                    </li>

                </if>
                <if condition="($v['group_id'] eq $vo['group_id']) and ($v['type'] eq 3)">
                    <li class="li-table">
                        <div class="li-table-l">
                            {:lang($v['title'])}
                            <div class="desc-text">
                                <if condition="$v['desc']">
                                    {:lang($v['desc'])}
                                </if>
                            </div>
                            <if condition="$debug eq 1 && $admin_id eq 1">
                                <a class="btn-bj" data-id="{$v['code']}" data-val="{$v['desc']}"  data-title="{$v['title']}" data-sort="{$v['sort']}">{:lang('EDIT')}</a>
                            </if>
                        </div>
                        <div class="li-table-r">
                            <div class="checkbox">
                                <foreach name="v['checkbox_val']" item="tv" key="i">
                                    <label>
                                        <input type="checkbox" name="{$v['code']}[]" value="{$i}" <foreach name="v['checkbox_check']" item="cv"><if condition="$i eq $cv"> checked </if></foreach> > {:lang($tv)}
                                    </label>
                                </foreach>
                            </div>
                        </div>
                    </li>

                </if>
                <if condition="($v['group_id'] eq $vo['group_id']) and ($v['type'] eq 4)">
                    <li class="li-table">
                        <div class="li-table-l">
                            {:lang($v['title'])}
                            <div class="desc-text">
                                <if condition="$v['desc']">
                                    {:lang($v['desc'])}
                                </if>
                            </div>
                            <if condition="$debug eq 1 && $admin_id eq 1">
                                <a class="btn-bj" data-id="{$v['code']}" data-val="{$v['desc']}"  data-title="{$v['title']}" data-sort="{$v['sort']}">{:lang('EDIT')}</a>
                            </if>
                        </div>
                        <div class="li-table-r">
                            <div class="checkbox">
                                <foreach name="v['type_val']" item="tv">
                                    <label>
                                        <input type="radio" name="{$v['code']}" value="{$key}" <if condition="$v['val'] eq $key"> checked </if> > {:lang($tv)}
                                    </label>
                                </foreach>
                            </div>
                        </div>
                    </li>

                </if>
                <if condition="($v['group_id'] eq $vo['group_id']) and ($v['type'] eq 5)">
                    <li class="li-table">
                        <div class="li-table-l">
                            <span class="form-required">*</span>{:lang($v['title'])}
                            <div class="desc-text">
                                <if condition="$v['desc']">
                                    {:lang($v['desc'])}
                                </if>
                            </div>
                            <if condition="$debug eq 1 && $admin_id eq 1">
                                <a class="btn-bj" data-id="{$v['code']}" data-val="{$v['desc']}"  data-title="{$v['title']}" data-sort="{$v['sort']}">{:lang('EDIT')}</a>
                            </if>
                        </div>
                        <div class="li-table-r">
                            <input type="text" class="form-control js-bootstrap-datetime" name="{$v['code']}"
                                   value="{$v['val']}" style="width: 140px;" autocomplete="off">
                        </div>
                    </li>

                </if>
                <if condition="($v['group_id'] eq $vo['group_id']) and ($v['type'] eq 6)">
                    <li class="li-table">
                        <div class="li-table-l">
                            <!--                                <span class="form-required">*</span>-->
                            {:lang($v['title'])}
                            <div class="desc-text">
                                <if condition="$v['desc']">
                                    {:lang($v['desc'])}
                                </if>
                            </div>
                            <if condition="$debug eq 1 && $admin_id eq 1">
                                <a class="btn-bj" data-id="{$v['code']}" data-val="{$v['desc']}"  data-title="{$v['title']}" data-sort="{$v['sort']}">{:lang('EDIT')}</a>
                            </if>
                        </div>
                        <div class="li-table-r form-control_sum_val">
                            <input type="button" class="form-control form-control_sum form-control_sum_btn" data-code="{$v['code']}" value="{:lang('增加')}">
                            <foreach name="v['list']" item="lv">
                                <input type="text" class="form-control form-control_sum"  name="{$v['code']}[]" value="{$lv|default=''}"  placeholder="{:lang('输入内容')}">
                            </foreach>
                        </div>
                    </li>
                </if>
                <if condition="($v['group_id'] eq $vo['group_id']) and ($v['type'] eq 7)">
                    <li class="li-table">
                        <div class="li-table-l">
                            <span class="form-required">*</span>{:lang($v['title'])}
                            <div class="desc-text">
                                <if condition="$v['desc']">
                                    {:lang($v['desc'])}
                                </if>
                            </div>
                            <if condition="$debug eq 1 && $admin_id eq 1">
                                <a class="btn-bj" data-id="{$v['code']}" data-val="{$v['desc']}"  data-title="{$v['title']}" data-sort="{$v['sort']}">{:lang('EDIT')}</a>
                            </if>
                        </div>
                        <div class="li-table-r">
                            <input type="text" class="form-control picker" name="{$v['code']}" value="{$v['val']|default=''}" style="width: 150px;">
                        </div>
                    </li>
                </if>
                <if condition="($v['group_id'] eq $vo['group_id']) and ($v['type'] eq 8)">
                    <li class="li-table">
                        <div class="li-table-l">
                            <span class="form-required"></span>{:lang($v['title'])}
                            <div class="desc-text">
                                <if condition="$v['desc']">
                                    {:lang($v['desc'])}
                                </if>
                            </div>
                            <if condition="$debug eq 1 && $admin_id eq 1">
                                <a class="btn-bj" data-id="{$v['code']}" data-val="{$v['desc']}"  data-title="{$v['title']}" data-sort="{$v['sort']}">{:lang('EDIT')}</a>
                            </if>
                        </div>
                        <div class="li-table-r">
                            <select class="form-control" name="{$v['code']}" id="">
                                <foreach name="$v['list']" item="lva" key="ki">
                                    <option value="{$ki}" <if condition="$ki eq $v['val']">selected</if> >{$lva}</option>
                                </foreach>

                            </select>
                        </div>
                    </li>
                </if>
            </foreach>
</div>
</foreach>
<!--            </ul>-->
<!--        </table>-->
<div class="form-group li-bottom">
    <div class="col-sm-offset-2 col-sm-10">
        <button type="submit" class="btn btn-primary js-ajax-submit" data-refresh="1">{:lang('SAVE')}</button>
        <div class="btn btn-primary" data-refresh="3" onclick="export_group()">{:lang("导出")}</div>
    </div>
</div>
</form>
</div>


</div>
<script type="text/javascript" src="__STATIC__/js/admin.js"></script>
<!-- 颜色值 -->
<script src="__TMPL__/public/assets/simpleboot3/js/colpick.js"></script>
<script>
    $(document).ready(function(){

        $(".form-control_sum_btn").click(function(){
            var code=$(this).attr("data-code");
            html='<input type="text" class="form-control form-control_sum"  name="'+code+'[]" placeholder="{:lang('输入内容')}">';
            $(".form-control_sum_val").append(html);
        });

        /*<!-- 颜色值 -->*/
        $('.picker').colpick({
            layout:'hex',
            submit:0,
            colorScheme:'dark',
            onChange:function(hsb,hex,rgb,el,bySetColor) {
                $(el).css('border-color','#'+hex);
                if(!bySetColor) $(el).val('#'+hex);
            }
        }).keyup(function(){
            $(this).colpickSetColor(this.value);
        });

    })
    $('.group').click(function(){
        var a= $(this).attr('data-id');
        //console.log(a);
        $('.group_id_val').val(a);
    })

    function export_group(){
        var id = $('.group_id_val').val();
        //console.log(id);return;
        layer.confirm("{:lang('确定导出？')}", {
            btn: ["{:lang('OK')}", "{:lang('OFF')}"] //按钮
        }, function () {
            $.ajax({
                url: "{:url('systems/export_group_json')}",
                type: 'post',
                dataType: 'json',
                data: {group_id: id},
                success: function (data) {
                    if (data.code == '1') {
                        var fileName = id;
                        var datastr = `data:text/json;charset=utf-8,${data.href}`;
                        var downloadAnchorNode = document.createElement("a");
                        downloadAnchorNode.setAttribute("href", datastr);
                        downloadAnchorNode.setAttribute("download", fileName + ".json");
                        downloadAnchorNode.click();
                        downloadAnchorNode.remove();
                        layer.msg( "{:lang('导出成功')}", {time: 2000, icon: 1}, function () {
                            //window.location.reload();
                        });
                    } else {
                        layer.msg( "{:lang('导出失败')}", {time: 2000, icon: 2});
                    }
                }
            });

        });
    }
    $('.btn-bj').click(function (){
        var code = $(this).attr('data-id');
        var val = $(this).attr('data-val');
        var title = $(this).attr('data-title');
        var sort = $(this).attr('data-sort');
        layer.open({
            type: 0,
            title:    "{:lang('编辑备注')}",
            area: ['500px', '300px'],   //宽高
            shade: 0.4,   //遮罩透明度
            btn: ["{:lang('OK')}", "{:lang('OFF')}"], //按钮组,
            content: '<div class="layui-form"><label class="layui-form-label">{:lang("标题：")}</label><input  type="text"  class="form-control" id="title" name="title" value="'+title+'" style="width: 450px;"><label class="layui-form-label">{:lang("备注：")}</label><input  type="text"  class="form-control" id="desc" name="desc" value="'+val+'" style="width: 450px;"><label class="layui-form-label">{:lang("排序：")}</label><input  type="text"  class="form-control" id="sort" name="sort" value="'+sort+'" style="width: 450px;"></div>',
            success:function(){

            },
            yes:function(index){   //点击确定回调
                //alert($('#vip_end_time').val());
                layer.close(index);
                $.ajax({
                    url: "{:url('systems/desc_set')}",
                    type: 'get',
                    dataType: 'json',
                    data: {code: code,desc:$('#desc').val(),title:$('#title').val(),sort:$('#sort').val()},
                    success: function (data) {
                        if(data['code'] == 1){
                            layer.msg(data['msg'],{time: 2000, icon:1},function(){
                                window.location.reload();
                            });
                        }else{
                            layer.msg(data['msg'],{time: 2000, icon:2});
                        }
                    }
                });
            }
        });
    });
</script>
</body>
</html>
