<include file="public@header" />
</head>
<body>
	<div class="wrap js-check-wrap">
		<ul class="nav nav-tabs">
			<li class="active"><a href="{:url('recording/index')}">{:lang('录音列表')}</a></li>
		</ul>
        <form class="well form-inline margin-top-20" method="post" action="{:url('recording/index')}">
            <!--用户名:-->
			{:lang('USER_ID')}:
            <input type="text" class="form-control" name="uid" style="width: 120px;" value="{:input('request.uid/s','')}" placeholder="{:lang('请输入用户名称')}">
			{:lang('STATUS')}：
	        <select name="status" style="width:120px;height:34px;line-height: 34px;">
	            <option value="-1">{:lang('ALL')}</option>
	            <option value="0" <if condition="$request.status == '0'"> selected="selected" </if>>{:lang('下架')}</option>
	            <option value="1" <if condition="$request.status == 1"> selected="selected" </if>>{:lang('上架')}</option>
	        </select>
            <input type="submit" class="btn btn-primary" value="{:lang('SEARCH')}" />
            <a class="btn btn-danger" href="{:url('recording/index')}">{:lang('EMPTY')}</a>
        </form>
		<table class="table table-hover table-bordered">
			<thead>
				<tr>
					<th width="50">ID</th>
					<th>{:lang('USER')}(ID)</th>
					<th>{:lang('录音标题')}</th>
					<th>{:lang('封面')}</th>
					<th>{:lang('ADMIN_LABEL')}</th>
					<th>{:lang('STATUS')}</th>
					<th>{:lang('TIME')}</th>
					<th width="130">{:lang('ACTIONS')}</th>
				</tr>
			</thead>

			<tbody>
				<foreach name="list" item="vo">
				<tr>
					<td>{$vo.id}</td>
					<td>{$vo['user_nickname']}({$vo['uid']})</td>
					<td>{$vo.title}</td>
					<td><img src="{$vo.img}" width="50"></td>
					<td>{$vo.label}</td>
					<td>
						<if condition="$vo['status'] eq 0">
							 已下架
							<else />
							上架中
						</if>
					</td>
					<td>{:date('Y-m-d H:i:s',$vo['addtime'])}</td>
					<td>
						<a href="javascript:void(0)" class="details" data-url="{$vo['img']}">{:lang('查看详情')}</a> |
						
						<if condition="$vo['status'] eq 0">
							 <a class="update_index" href="javascript:void(0)" data-id="{$vo['id']}" data-status="1">{:lang('上架')}</a>|
							<else />
							<a class="update_index" href="javascript:void(0)" data-id="{$vo['id']}" data-status="0">{:lang('下架')}</a>|
						</if>
						<a class="update_index" href="javascript:void(0)" data-id="{$vo['id']}" data-status="2">{:lang('DELETE')}</a>
					</td>
				</tr>
				</foreach>
			</tbody>
		</table>
		<div class="pagination">{$page}</div>
	</div>
	<script src="__STATIC__/js/admin.js"></script>
	<script src="__STATIC__/js/layer/layer.js" rel="stylesheet"></script>
	<script>

        $(".details").click(function(){
	        var url=$(this).attr("data-url");
	        //图片显示
	        layer.open({
	            type: 1,
	            title: false,
	            closeBtn: 0,
	            area: ['300px', '300px'],
	            skin: 'layui-layer-nobg', //没有背景色
	            shadeClose: true,
	            content: "<img src='"+url+"' style='width:100%;height:100%;'/>"
	        });
	    })
	    $(".update_index").click(function(){
	        var id=$(this).attr("data-id");
	        var status=$(this).attr("data-status");
	        var name=status == 1 ? '是否上架？' : status == 2 ? '是否删除？' : '是否下架？';
	     
		    layer.confirm(name, {
	            btn: ["{:lang('OK')}", "{:lang('OFF')}"] //按钮
	        }, function () {
	            $.ajax({
	                url: "{:url('recording/update_index')}",
	                type: 'get',
	                dataType: 'json',
	                data: {id: id,status:status},
	                success: function (data) {
	                    if(data == 1){
	                        layer.msg(lang('Operation_successful'),{time: 2000, icon:1},function(){
	                            window.location.reload();
	                        });
	                    }else{
	                        layer.msg("{:lang('operation_failed')}",{time: 2000, icon:2});
	                    }
	                }
	            });
	        });
	          
   		 })

	</script>
</body>
</html>